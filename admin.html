<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Iizuka Lab Poll</title>
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="admin-header">
        <div class="header-content">
            <div class="header-left">
                <h1><i class="fas fa-chart-line"></i> Admin Dashboard</h1>
            </div>
            <div class="header-right">
                <button class="header-btn" onclick="location.reload()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
                <button class="header-btn primary" id="startNewVoteBtn">
                    <i class="fas fa-plus-circle"></i> Start New Vote
                </button>
                <button class="header-btn success" id="saveArchiveBtn">
                    <i class="fas fa-save"></i> Save to Archive
                </button>
                <button class="header-btn danger" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="admin-main">
        <!-- Loading Screen -->
        <div id="loadingScreen" class="loading-screen">
            <div class="loading-spinner"></div>
            <p>Loading dashboard data...</p>
        </div>

        <!-- Dashboard Content -->
        <div id="dashboardContent" style="display: none;">
            <!-- Statistics Cards -->
            <section class="stats-section">
                <div class="stat-card">
                    <div class="stat-icon" style="background: #3498db;">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalResponses">0</h3>
                        <p>Total Responses</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: #2ecc71;">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalAttending">0</h3>
                        <p>Attending</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: #e74c3c;">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalNotAttending">0</h3>
                        <p>Not Attending</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: #f39c12;">
                        <i class="fas fa-yen-sign"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalCost">¥0</h3>
                        <p>Total Cost</p>
                    </div>
                </div>
            </section>

            <!-- Charts Section -->
            <section class="charts-section">
                <div class="chart-container">
                    <h2><i class="fas fa-pie-chart"></i> Attendance Breakdown</h2>
                    <canvas id="attendanceChart"></canvas>
                </div>

                <div class="chart-container">
                    <h2><i class="fas fa-chart-bar"></i> Date Popularity Analysis</h2>
                    <canvas id="datePopularityChart"></canvas>
                    <p class="chart-hint">Shows how many people selected each date - helps you choose the best option!</p>
                </div>
            </section>

            <!-- Responses Table -->
            <section class="table-section">
                <h2><i class="fas fa-table"></i> All Responses</h2>
                
                <!-- Filters -->
                <div class="table-filters">
                    <div class="filter-group">
                        <label><i class="fas fa-filter"></i> Filter by Position:</label>
                        <select id="positionFilter">
                            <option value="all">All Positions</option>
                            <option value="Bachelor Student">Bachelor Student</option>
                            <option value="Master's Student">Master's Student</option>
                            <option value="PhD Student">PhD Student</option>
                            <option value="Faculty/Staff">Faculty/Staff</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label><i class="fas fa-filter"></i> Filter by Payment:</label>
                        <select id="paymentFilter">
                            <option value="all">All Status</option>
                            <option value="paid">Paid</option>
                            <option value="unpaid">Unpaid</option>
                        </select>
                    </div>
                </div>

                <div class="table-wrapper">
                    <table id="responsesTable" class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Attendance</th>
                                <th>Position</th>
                                <th>Selected Dates</th>
                                <th>Amount</th>
                                <th>Payment</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="responsesTableBody">
                            <tr>
                                <td colspan="7" class="no-data">No responses yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Export Section -->
            <section class="export-section">
                <h2><i class="fas fa-download"></i> Export Data</h2>
                <div class="export-buttons">
                    <button class="export-btn" id="exportExcelBtn">
                        <i class="fas fa-file-excel"></i> Export to Excel
                    </button>
                    <button class="export-btn" id="exportPDFBtn">
                        <i class="fas fa-file-pdf"></i> Export to PDF
                    </button>
                    <button class="export-btn" id="exportCSVBtn">
                        <i class="fas fa-file-csv"></i> Export to CSV
                    </button>
                </div>
            </section>

            <!-- Pricing Configuration -->
            <section class="config-section">
                <h2><i class="fas fa-sliders-h"></i> Pricing Configuration</h2>
                <div class="config-card">
                    <div class="config-row">
                        <label for="basePrice">Base Price (¥)</label>
                        <input type="number" id="basePrice" value="10000" min="0" step="100">
                    </div>

                    <div class="pricing-sliders">
                        <div class="slider-group">
                            <label>
                                Bachelor Students: <span id="bachelorPercentValue">15</span>%
                            </label>
                            <input type="range" id="bachelorPercent" min="0" max="100" value="15" step="5">
                        </div>

                        <div class="slider-group">
                            <label>
                                Master's Students: <span id="masterPercentValue">20</span>%
                            </label>
                            <input type="range" id="masterPercent" min="0" max="100" value="20" step="5">
                        </div>

                        <div class="slider-group">
                            <label>
                                PhD Students: <span id="phdPercentValue">30</span>%
                            </label>
                            <input type="range" id="phdPercent" min="0" max="100" value="30" step="5">
                        </div>

                        <div class="slider-group">
                            <label>
                                Faculty/Staff: <span id="facultyPercentValue">35</span>%
                            </label>
                            <input type="range" id="facultyPercent" min="0" max="100" value="35" step="5">
                        </div>
                    </div>

                    <button class="save-btn" id="savePricingBtn">
                        <i class="fas fa-save"></i> Save Pricing
                    </button>
                </div>
            </section>

            <!-- Poll Configuration -->
            <section class="config-section">
                <h2><i class="fas fa-cog"></i> Poll Configuration</h2>
                <div class="config-card">
                    <div class="config-row">
                        <label for="pollTitle">Poll Title</label>
                        <input type="text" id="pollTitle" value="Iizuka Lab Dinner Poll">
                    </div>

                    <div class="date-range-row">
                        <div class="date-input-group">
                            <label for="startDate">Start Date</label>
                            <input type="date" id="startDate">
                        </div>
                        <div class="date-input-group">
                            <label for="endDate">End Date</label>
                            <input type="date" id="endDate">
                        </div>
                        <button class="generate-btn" id="generateDatesBtn">
                            <i class="fas fa-calendar-plus"></i> Generate Dates
                        </button>
                    </div>

                    <div id="datePreview" class="date-preview" style="display: none;">
                        <i class="fas fa-info-circle"></i>
                        <span id="datePreviewText"></span>
                    </div>

                    <button class="save-btn" id="savePollConfigBtn">
                        <i class="fas fa-save"></i> Save Configuration
                    </button>
                </div>
            </section>

            <!-- Archives Section -->
            <section class="archives-section">
                <h2><i class="fas fa-archive"></i> Poll Archives</h2>
                <div id="archivesList" class="archives-list">
                    <p class="no-data">No archives yet</p>
                </div>
            </section>
        </div>
    </main>

    <!-- Modals -->
    <div id="editAmountModal" class="modal">
        <div class="modal-content">
            <h3><i class="fas fa-edit"></i> Edit Amount</h3>
            <p>Edit the payment amount for <strong id="editName"></strong></p>
            <div class="modal-form">
                <label>New Amount (¥)</label>
                <input type="number" id="editAmount" min="0" step="100">
                <p class="modal-hint">Leave empty to reset to default calculated amount</p>
            </div>
            <div class="modal-actions">
                <button class="modal-btn cancel" onclick="closeEditAmountModal()">Cancel</button>
                <button class="modal-btn save" id="saveAmountBtn">Save</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- SheetJS for Excel export -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <!-- Application Scripts -->
    <script src="js/firebase-config.js"></script>
    <script src="js/firebase-api.js"></script>
    <script src="js/admin.js"></script>
</body>
</html>

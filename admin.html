<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Iizuka Lab Poll</title>
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="admin-container">
        <header class="admin-header">
            <h1><i class="fas fa-chart-line"></i> Admin Dashboard</h1>
            <div class="header-actions">
                <button id="start-new-vote-btn" class="btn btn-success">
                    <i class="fas fa-plus-circle"></i> Start New Vote
                </button>
                <button id="save-archive-btn" class="btn btn-primary">
                    <i class="fas fa-save"></i> Save to Archive
                </button>
                <button id="refresh-btn" class="btn btn-secondary">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
                <button id="logout-btn" class="btn btn-secondary">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </header>

        <div id="loading-message" class="loading-message">
            <i class="fas fa-spinner fa-spin"></i> Loading dashboard...
        </div>

        <div id="dashboard-content" style="display: none;">
            <!-- Statistics Cards -->
            <section class="stats-section">
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-users"></i></div>
                    <div class="stat-info">
                        <h3>Total Responses</h3>
                        <p id="total-responses" class="stat-number">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                    <div class="stat-info">
                        <h3>Attending</h3>
                        <p id="attending-count" class="stat-number">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-coins"></i></div>
                    <div class="stat-info">
                        <h3>Total Cost</h3>
                        <p id="total-cost" class="stat-number">¥0</p>
                    </div>
                </div>
            </section>

            <!-- Charts -->
            <section class="charts-section">
                <div class="chart-container">
                    <h2><i class="fas fa-chart-pie"></i> Attendance Breakdown</h2>
                    <canvas id="attendance-chart"></canvas>
                </div>
                <div class="chart-container">
                    <h2><i class="fas fa-chart-bar"></i> Date Popularity</h2>
                    <canvas id="date-popularity-chart"></canvas>
                </div>
            </section>

            <!-- Responses Table -->
            <section class="table-section">
                <h2><i class="fas fa-table"></i> All Responses</h2>
                <div class="table-controls">
                    <button id="export-xlsx-btn" class="btn btn-primary">
                        <i class="fas fa-file-excel"></i> Export XLSX
                    </button>
                    <button id="export-pdf-btn" class="btn btn-primary">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
                    <button id="export-csv-btn" class="btn btn-primary">
                        <i class="fas fa-file-csv"></i> Export CSV
                    </button>
                </div>
                <div class="table-responsive">
                    <table id="responses-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Attendance</th>
                                <th>Position</th>
                                <th>Selected Dates</th>
                                <th>Amount</th>
                                <th>Paid</th>
                                <th>Timestamp</th>
                            </tr>
                        </thead>
                        <tbody id="responses-tbody">
                            <!-- Data will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Pricing Configuration -->
            <section class="config-section">
                <h2><i class="fas fa-coins"></i> Pricing Configuration</h2>
                <div class="pricing-grid">
                    <!-- Base Price -->
                    <div class="form-group">
                        <label for="base-price">Base Price (¥):</label>
                        <input type="number" id="base-price" value="10000" min="0" step="100">
                    </div>

                    <!-- Bachelor Students -->
                    <div class="form-group">
                        <label for="bachelor-percentage">
                            <i class="fas fa-graduation-cap"></i> Bachelor Students:
                        </label>
                        <div class="percentage-control">
                            <input 
                                type="range" 
                                id="bachelor-percentage" 
                                min="0" 
                                max="100" 
                                value="15" 
                                step="1" 
                                class="percentage-slider"
                            >
                            <input 
                                type="number" 
                                id="bachelor-percentage-input" 
                                min="0" 
                                max="100" 
                                value="15" 
                                step="0.5" 
                                class="percentage-input"
                            >
                            <span class="percentage-label">%</span>
                        </div>
                        <div class="amount-display" id="bachelor-amount">¥1,500</div>
                    </div>

                    <!-- Master's Students -->
                    <div class="form-group">
                        <label for="master-percentage">
                            <i class="fas fa-user-graduate"></i> Master's Students:
                        </label>
                        <div class="percentage-control">
                            <input 
                                type="range" 
                                id="master-percentage" 
                                min="0" 
                                max="100" 
                                value="20" 
                                step="1" 
                                class="percentage-slider"
                            >
                            <input 
                                type="number" 
                                id="master-percentage-input" 
                                min="0" 
                                max="100" 
                                value="20" 
                                step="0.5" 
                                class="percentage-input"
                            >
                            <span class="percentage-label">%</span>
                        </div>
                        <div class="amount-display" id="master-amount">¥2,000</div>
                    </div>

                    <!-- PhD Students -->
                    <div class="form-group">
                        <label for="phd-percentage">
                            <i class="fas fa-user-tie"></i> PhD Students:
                        </label>
                        <div class="percentage-control">
                            <input 
                                type="range" 
                                id="phd-percentage" 
                                min="0" 
                                max="100" 
                                value="30" 
                                step="1" 
                                class="percentage-slider"
                            >
                            <input 
                                type="number" 
                                id="phd-percentage-input" 
                                min="0" 
                                max="100" 
                                value="30" 
                                step="0.5" 
                                class="percentage-input"
                            >
                            <span class="percentage-label">%</span>
                        </div>
                        <div class="amount-display" id="phd-amount">¥3,000</div>
                    </div>

                    <!-- Faculty/Staff -->
                    <div class="form-group">
                        <label for="faculty-percentage">
                            <i class="fas fa-chalkboard-teacher"></i> Faculty/Staff:
                        </label>
                        <div class="percentage-control">
                            <input 
                                type="range" 
                                id="faculty-percentage" 
                                min="0" 
                                max="100" 
                                value="35" 
                                step="1" 
                                class="percentage-slider"
                            >
                            <input 
                                type="number" 
                                id="faculty-percentage-input" 
                                min="0" 
                                max="100" 
                                value="35" 
                                step="0.5" 
                                class="percentage-input"
                            >
                            <span class="percentage-label">%</span>
                        </div>
                        <div class="amount-display" id="faculty-amount">¥3,500</div>
                    </div>
                </div>

                <!-- Total Percentage Display -->
                <div class="total-percentage">
                    <span>Total: </span>
                    <span id="total-percentage" class="total-value">100</span>
                    <span>%</span>
                    <span id="total-validation" class="validation-icon"></span>
                </div>

                <button id="save-pricing-btn" class="btn btn-success">
                    <i class="fas fa-save"></i> Save Pricing
                </button>
            </section>

            <!-- Poll Configuration -->
            <section class="config-section">
                <h2><i class="fas fa-cog"></i> Poll Configuration</h2>
                <div class="form-group">
                    <label for="poll-title">Poll Title:</label>
                    <input type="text" id="poll-title" placeholder="Iizuka Lab Dinner Poll">
                </div>
                <div class="date-range-group">
                    <div class="form-group">
                        <label for="start-date">Start Date:</label>
                        <input type="date" id="start-date">
                    </div>
                    <div class="form-group">
                        <label for="end-date">End Date:</label>
                        <input type="date" id="end-date">
                    </div>
                </div>
                <button id="generate-dates-btn" class="btn btn-primary">
                    <i class="fas fa-calendar-plus"></i> Generate Dates
                </button>
                <div id="dates-preview" class="dates-preview"></div>
                <button id="save-config-btn" class="btn btn-success">
                    <i class="fas fa-save"></i> Save Configuration
                </button>
            </section>

            <!-- Archives Section -->
            <section class="archives-section">
                <h2><i class="fas fa-archive"></i> Poll Archives</h2>
                <div id="archives-list" class="archives-list">
                    <!-- Archives will be loaded here -->
                </div>
            </section>
        </div>
    </div>

    <!-- Edit Amount Modal -->
    <div id="edit-amount-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>Edit Amount</h2>
            <div class="modal-body">
                <p id="edit-amount-name"></p>
                <label for="edit-amount-input">New Amount (¥):</label>
                <input type="number" id="edit-amount-input" min="0" step="100">
                <div class="modal-actions">
                    <button id="save-amount-btn" class="btn btn-success">Save</button>
                    <button id="reset-amount-btn" class="btn btn-secondary">Reset to Default</button>
                    <button class="btn btn-secondary modal-close">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- Application Scripts -->
    <script src="js/firebase-config.js"></script>
    <script src="js/firebase-api.js"></script>
    <script src="js/admin.js"></script>
</body>
</html>

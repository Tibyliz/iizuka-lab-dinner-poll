# 🧪 功能测试指南

快速测试指南,确保所有归档管理功能正常工作。

## 📋 测试前准备

1. ✅ 在浏览器中打开 `index.html`
2. ✅ 登录管理页面 (密码: `iizukalab`)
3. ✅ 准备测试数据

---

## 🎯 测试场景1: 基础功能测试

### 步骤1: 创建测试数据 (5分钟)

**提交3个测试回复:**

```
回复1:
- 姓名: 张三
- 参加: 是
- 职称: Master Student
- 日期: 选择2-3个日期

回复2:
- 姓名: 李四
- 参加: 是
- 职称: Doctoral Student
- 日期: 选择2-3个日期

回复3:
- 姓名: 王五
- 参加: 否
- 职称: Teachers and Staff
```

**检查点:**
- ✅ 3个回复显示在管理页面
- ✅ 统计显示正确 (3总数, 2参加, 1不参加)
- ✅ 图表显示选择的日期

### 步骤2: 设置价格 (2分钟)

```
1. 点击 "Price Settings"
2. 输入:
   - 总费用: 10000
   - 硕士: 20%
   - 博士: 30%
   - 教师: 50%
3. 保存
```

**检查点:**
- ✅ 总和显示 100% (绿色)
- ✅ 预览显示每类人员价格
- ✅ 表格中显示每人应付金额

### 步骤3: 标记付款 (1分钟)

```
1. 勾选张三的付款复选框
2. 勾选李四的付款复选框
```

**检查点:**
- ✅ 显示绿色的 ✓ 图标
- ✅ 顶部统计显示 "2 / 2 Paid"

---

## 🗂️ 测试场景2: 归档管理功能

### 测试1: 保存当前投票 ⭐

**步骤:**
```
1. 点击 "Poll Management"
2. 点击 "Save Current Poll to Archive"
3. 输入名称: "Test Poll 1"
4. 点击 Save
```

**检查点:**
- ✅ 显示成功提示
- ✅ 模态框自动关闭
- ✅ 当前数据仍然存在 (3个回复)

**验证保存:**
```
1. 点击 "Poll Management"
2. 点击 "View Archived Polls"
3. 应该看到 "Test Poll 1" 归档
```

**检查归档信息:**
- ✅ 名称: Test Poll 1
- ✅ 日期: 今天的日期
- ✅ 统计: 3 responses, 2 attending, 2 paid
- ✅ 三个按钮: Restore, Export, Delete

---

### 测试2: 开始新投票 ⭐

**步骤:**
```
1. 点击 "Poll Management"
2. 点击 "Start New Poll"
3. 阅读确认对话框
4. 点击 "确定"
```

**检查点:**
- ✅ 所有回复被清除
- ✅ 表格显示 "No responses"
- ✅ 统计归零 (0, 0, 0, 0)
- ✅ 图表清空
- ✅ 当前投票名称更新

**验证设置保留:**
- ✅ 价格设置仍然存在
- ✅ 投票标题仍然存在
- ✅ 密码仍然有效

---

### 测试3: 添加新数据

**提交2个新回复:**
```
回复1:
- 姓名: 赵六
- 参加: 是
- 职称: Doctoral Student
- 日期: 选择2-3个日期

回复2:
- 姓名: 孙七
- 参加: 是
- 职称: Master Student
- 日期: 选择2-3个日期
```

**检查点:**
- ✅ 显示2个新回复
- ✅ 之前的3个回复不存在
- ✅ 统计显示 (2总数, 2参加)

---

### 测试4: 再次保存归档

**步骤:**
```
1. 点击 "Poll Management"
2. 点击 "Save Current Poll to Archive"
3. 输入名称: "Test Poll 2"
4. 点击 Save
```

**验证两个归档:**
```
1. 打开归档列表
2. 应该看到两个归档:
   - Test Poll 1 (3 responses)
   - Test Poll 2 (2 responses)
```

---

### 测试5: 恢复归档 ⭐

**步骤:**
```
1. 打开归档列表
2. 找到 "Test Poll 1"
3. 点击 "Restore" 按钮
4. 阅读确认对话框
5. 点击 "确定"
```

**检查点:**
- ✅ 当前投票名称更新为 "Test Poll 1"
- ✅ 显示3个回复 (张三, 李四, 王五)
- ✅ 统计显示 (3, 2, 1, 2)
- ✅ 付款状态被恢复 (张三和李四已付款)
- ✅ 价格设置保持不变

**验证数据完整性:**
- ✅ 每个人的姓名正确
- ✅ 出席状态正确
- ✅ 职称正确
- ✅ 可用日期正确

---

### 测试6: 导出归档 ⭐

**测试导出 Test Poll 2:**
```
1. 打开归档列表
2. 找到 "Test Poll 2"
3. 点击 "Export" 按钮
4. XLSX文件自动下载
```

**检查导出文件:**
- ✅ 文件名包含归档名称
- ✅ 打开文件,看到2行数据 (赵六, 孙七)
- ✅ 包含所有列 (姓名, 出席, 职称, 日期, 价格, 付款)
- ✅ 价格计算正确

**优势验证:**
- ✅ 导出后,当前投票仍然是 "Test Poll 1"
- ✅ 没有影响当前数据
- ✅ 可以导出归档而无需恢复

---

### 测试7: 删除归档 ⭐

**步骤:**
```
1. 打开归档列表
2. 找到 "Test Poll 2"
3. 点击 "Delete" 按钮
4. 阅读确认对话框
5. 点击 "确定"
```

**检查点:**
- ✅ 显示成功提示
- ✅ "Test Poll 2" 从列表中消失
- ✅ 只剩下 "Test Poll 1"
- ✅ 当前投票不受影响

---

## 🎯 测试场景3: 综合测试

### 测试完整工作流程

**步骤1: 组织第一次聚餐**
```
1. 收集5个回复
2. 设置价格
3. 标记付款
4. 保存归档: "November Dinner"
```

**步骤2: 组织第二次聚餐**
```
1. 开始新投票
2. 收集3个回复
3. 保存归档: "December Dinner"
```

**步骤3: 组织第三次聚餐**
```
1. 开始新投票
2. 收集7个回复
```

**验证:**
```
1. 当前投票: 7个回复
2. 归档列表:
   - November Dinner (5 responses)
   - December Dinner (3 responses)
```

**测试恢复:**
```
1. 恢复 November Dinner
2. 查看5个原始回复
3. 恢复 December Dinner
4. 查看3个原始回复
5. 再次恢复当前投票或创建新投票
```

---

## 🧪 边界测试

### 测试1: 空归档
```
1. 开始新投票 (0个回复)
2. 立即保存归档
3. 验证可以保存
4. 恢复归档,应该显示0个回复
```

### 测试2: 同名归档
```
1. 保存归档: "Test"
2. 再次保存归档: "Test"
3. 归档列表显示两个 "Test" (不同ID)
4. 验证可以独立恢复/删除
```

### 测试3: 大量回复
```
1. 提交20+个回复
2. 保存归档
3. 恢复归档
4. 验证所有数据完整
```

### 测试4: 特殊字符
```
归档名称测试:
- "2024-11 聚餐"
- "Test & Demo"
- "Party #1 (Special)"
验证所有名称都能正确保存和显示
```

---

## ✅ 测试检查清单

### 保存归档
- [ ] 可以输入自定义名称
- [ ] 保存成功提示
- [ ] 当前数据不变
- [ ] 归档出现在列表中
- [ ] 统计信息正确

### 开始新投票
- [ ] 确认对话框显示
- [ ] 所有回复清除
- [ ] 设置保留
- [ ] 统计归零
- [ ] 投票名称更新

### 查看归档
- [ ] 显示所有归档
- [ ] 归档信息完整
- [ ] 操作按钮可用
- [ ] 空状态正确
- [ ] 响应式布局

### 恢复归档
- [ ] 确认对话框显示
- [ ] 数据完整恢复
- [ ] 付款状态恢复
- [ ] 价格设置恢复
- [ ] 投票名称更新

### 导出归档
- [ ] XLSX文件生成
- [ ] 包含所有数据
- [ ] 价格正确
- [ ] 付款状态正确
- [ ] 不影响当前投票

### 删除归档
- [ ] 确认对话框显示
- [ ] 归档被删除
- [ ] 列表更新
- [ ] 不影响当前投票
- [ ] 成功提示显示

---

## 🐛 常见问题排查

### 问题1: 归档列表为空
**排查:**
- 检查是否已保存归档
- 打开浏览器控制台,输入:
  ```javascript
  JSON.parse(localStorage.getItem('poll_archives'))
  ```
- 如果返回null或[],说明没有归档

### 问题2: 恢复归档后数据不对
**排查:**
- 确认恢复的是正确的归档
- 清除浏览器缓存重试
- 检查归档数据:
  ```javascript
  const archives = JSON.parse(localStorage.getItem('poll_archives'));
  console.log(archives);
  ```

### 问题3: 导出文件为空
**排查:**
- 确认归档包含回复数据
- 检查XLSX.js库是否加载
- 打开浏览器控制台查看错误

### 问题4: 删除归档后仍显示
**排查:**
- 刷新页面
- 重新打开归档列表
- 清除浏览器缓存

---

## 📊 测试结果记录

### 测试日期: ____________

### 测试环境
- 浏览器: ____________
- 版本: ____________
- 操作系统: ____________

### 功能测试结果
| 功能 | 状态 | 备注 |
|------|------|------|
| 保存归档 | ⬜ 通过 / ⬜ 失败 | |
| 开始新投票 | ⬜ 通过 / ⬜ 失败 | |
| 查看归档 | ⬜ 通过 / ⬜ 失败 | |
| 恢复归档 | ⬜ 通过 / ⬜ 失败 | |
| 导出归档 | ⬜ 通过 / ⬜ 失败 | |
| 删除归档 | ⬜ 通过 / ⬜ 失败 | |

### 总体评价
- 功能完整性: ⭐⭐⭐⭐⭐
- 易用性: ⭐⭐⭐⭐⭐
- 稳定性: ⭐⭐⭐⭐⭐
- 用户体验: ⭐⭐⭐⭐⭐

---

## 🎉 测试完成

如果所有测试都通过,恭喜你!归档管理功能可以正常使用了!

**下一步:**
1. ✅ 修改默认密码
2. ✅ 开始实际使用
3. ✅ 定期备份数据
4. ✅ 查看文档获取更多技巧

祝使用愉快! 🎊

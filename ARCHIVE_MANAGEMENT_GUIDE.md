# 📦 投票归档管理完整指南

本指南详细说明如何使用新的投票归档管理功能。

## 🎯 功能概览

投票归档管理功能让你可以:
- 保存当前投票的完整快照
- 开始新的投票活动
- 查看所有历史投票
- 恢复过去的投票数据
- 导出归档的投票报告
- 删除不需要的旧归档

## 📚 完整功能说明

### 1. 保存当前投票到归档

#### 什么时候使用?
- ✅ 投票活动结束后
- ✅ 开始新投票之前
- ✅ 想保留重要的历史数据
- ✅ 定期备份当前进度

#### 如何操作?

**步骤:**
1. 登录管理页面
2. 点击顶部的 **"Poll Management"** 按钮
3. 在弹出的窗口中点击 **"Save Current Poll to Archive"**
4. 输入一个有意义的投票名称
   - 例如: "2024年11月聚餐"
   - 例如: "Year-End Celebration 2024"
   - 例如: "Welcome Party for New Students"
5. 点击 **"Save"** 按钮

#### 保存了什么?
- ✅ 所有回复数据 (姓名、出席、职称、日期)
- ✅ 价格设置 (总费用和百分比)
- ✅ 投票标题
- ✅ 统计信息 (总数、出席、付款)
- ✅ 付款状态

#### 注意事项
- ⚠️ 保存后,当前投票数据**不会被清除**
- ✅ 可以继续收集更多回复
- ✅ 可以多次保存同一投票 (使用不同的名称)

---

### 2. 开始新投票

#### 什么时候使用?
- ✅ 上一次活动已完成
- ✅ 需要为新活动收集回复
- ✅ 想要清空所有当前回复

#### 如何操作?

**步骤:**
1. **重要**: 先保存当前投票(如果需要保留)
2. 点击 **"Poll Management"**
3. 点击 **"Start New Poll"**
4. 阅读确认对话框:
   ```
   Are you sure you want to start a new poll?
   
   This will:
   - Clear all current responses
   - Keep your admin settings (password, prices, title)
   
   Make sure you have saved the current poll to archives if needed!
   ```
5. 点击 **"确定"** 开始新投票

#### 会发生什么?
- ✅ **清除**: 所有当前回复被删除
- ✅ **保留**: 管理员密码
- ✅ **保留**: 价格设置
- ✅ **保留**: 投票标题
- ✅ **更新**: 当前投票名称变为 "New Poll - 日期"

#### 警告
- ⚠️ 此操作**不可撤销**
- ⚠️ 未保存的回复将**永久丢失**
- ✅ 建议: 总是先保存再开始新投票

---

### 3. 查看归档投票列表

#### 如何操作?

**步骤:**
1. 点击 **"Poll Management"**
2. 点击 **"View Archived Polls"**
3. 浏览所有已保存的归档

#### 归档卡片显示什么?

每个归档显示:
```
┌─────────────────────────────────────┐
│ November 2024 Dinner    2024/11/17  │
├─────────────────────────────────────┤
│ 👥 15 responses                      │
│ ✓ 12 attending                       │
│ 💰 10 paid                           │
├─────────────────────────────────────┤
│ [Restore] [Export] [Delete]         │
└─────────────────────────────────────┘
```

#### 可用操作
- **Restore**: 恢复此归档为当前投票
- **Export**: 导出归档数据为XLSX文件
- **Delete**: 永久删除此归档

---

### 4. 恢复归档投票

#### 什么时候使用?
- ✅ 需要查看历史数据
- ✅ 需要继续之前的投票
- ✅ 需要重新导出报告

#### 如何操作?

**步骤:**
1. 打开归档列表
2. 找到要恢复的归档
3. 点击 **"Restore"** 按钮
4. 阅读确认对话框:
   ```
   Are you sure you want to restore this archived poll?
   
   This will replace the current poll data with the archived data.
   Make sure you have saved the current poll if needed!
   ```
5. 点击 **"确定"** 恢复

#### 会发生什么?
- ✅ 当前回复被替换为归档的回复
- ✅ 价格设置被恢复
- ✅ 投票标题被恢复
- ✅ 当前投票名称更新为归档名称
- ✅ 付款状态也被恢复

#### 警告
- ⚠️ 当前投票数据会被**覆盖**
- ⚠️ 建议: 先保存当前投票
- ✅ 可以随时再次恢复其他归档

---

### 5. 导出归档投票

#### 什么时候使用?
- ✅ 需要归档的报告
- ✅ 不想恢复归档但需要数据
- ✅ 创建备份文件

#### 如何操作?

**步骤:**
1. 打开归档列表
2. 找到要导出的归档
3. 点击 **"Export"** 按钮
4. XLSX文件自动下载

#### 导出内容
- ✅ 所有回复数据
- ✅ 价格信息
- ✅ 付款状态
- ✅ 完整的表格格式

#### 优势
- ✅ 无需恢复归档
- ✅ 不影响当前投票
- ✅ 快速获取历史数据

---

### 6. 删除归档投票

#### 什么时候使用?
- ✅ 归档不再需要
- ✅ 清理旧数据
- ✅ 释放存储空间

#### 如何操作?

**步骤:**
1. 打开归档列表
2. 找到要删除的归档
3. 点击 **"Delete"** 按钮
4. 阅读确认对话框:
   ```
   Are you sure you want to delete this archived poll?
   This cannot be undone!
   ```
5. 点击 **"确定"** 删除

#### 警告
- ⚠️ 删除**无法撤销**
- ⚠️ 归档数据**永久丢失**
- ✅ 建议: 删除前先导出备份

---

## 💡 最佳实践

### 命名规范
使用清晰的命名格式:
```
✅ 好的命名:
- "2024-11 Monthly Dinner"
- "Year-End Celebration 2024"
- "Welcome Party - November 2024"
- "PhD Defense Celebration - Dr. Tanaka"

❌ 不好的命名:
- "test"
- "poll1"
- "aaa"
- "11月"
```

### 保存时机
- ✅ 活动结束后立即保存
- ✅ 开始新投票前保存
- ✅ 每月底保存当月投票
- ✅ 重要活动保存多个版本

### 归档管理
- 定期查看归档列表
- 删除不需要的旧归档
- 重要归档导出XLSX备份
- 每季度整理一次归档

### 备份策略
```
第1层: 归档功能 (浏览器localStorage)
第2层: XLSX导出 (本地文件)
第3层: 云存储备份 (Google Drive/OneDrive)
```

---

## 🔄 完整工作流程示例

### 场景: 组织三次月度聚餐

#### 11月聚餐
```
1. 设置标题: "Iizuka Lab November 2024 Dinner"
2. 收集回复 (15人)
3. 确定日期和收款
4. 活动结束后:
   - Poll Management → Save Current Poll
   - 命名: "2024-11 Monthly Dinner"
   - 导出XLSX报告
```

#### 12月聚餐
```
1. Poll Management → Start New Poll
2. 修改标题: "Iizuka Lab December 2024 Dinner"
3. 收集新的回复 (18人)
4. 确定日期和收款
5. 活动结束后保存归档: "2024-12 Monthly Dinner"
```

#### 1月聚餐
```
1. Start New Poll
2. 修改标题: "Iizuka Lab January 2025 Dinner"
3. 收集回复 (20人)
```

#### 查看历史数据
```
1. Poll Management → View Archived Polls
2. 看到三个归档:
   - 2024-11 Monthly Dinner
   - 2024-12 Monthly Dinner
   - 2024-12 Year-End Celebration
3. 可以随时恢复或导出任何一个
```

---

## 🚨 常见问题

### Q1: 保存归档后当前数据会消失吗?
**A**: 不会! 保存归档只是创建一个副本,当前数据完全保留。

### Q2: 可以保存多个同名的归档吗?
**A**: 可以,但不建议。每个归档有唯一ID,但同名会造成混淆。

### Q3: 归档可以保存多少个?
**A**: 理论上无限制,但受浏览器localStorage容量限制 (通常5-10MB)。建议定期清理旧归档。

### Q4: 恢复归档会影响付款状态吗?
**A**: 是的,付款状态也会被恢复为归档时的状态。

### Q5: 删除归档会影响当前投票吗?
**A**: 不会,删除归档只删除历史数据,不影响当前投票。

### Q6: 可以编辑已保存的归档吗?
**A**: 不能直接编辑。如需修改,可以恢复归档→修改数据→重新保存。

### Q7: 浏览器清除数据会丢失归档吗?
**A**: 会! 所有归档存储在localStorage中。建议定期导出XLSX备份。

### Q8: 可以在不同电脑上访问同一归档吗?
**A**: 不能,数据存储在本地浏览器。需要固定用一台电脑管理。

---

## 📊 数据结构说明

归档数据结构:
```javascript
{
  id: "1700220000000",           // 唯一标识
  name: "November 2024 Dinner",  // 归档名称
  date: "2024-11-17T10:00:00Z",  // 保存时间
  responses: [...],               // 所有回复
  settings: {                     // 设置快照
    totalCost: 10000,
    masterPercent: 20,
    doctoralPercent: 30,
    staffPercent: 50,
    pollTitle: "..."
  },
  statistics: {                   // 统计信息
    total: 15,
    attending: 12,
    notAttending: 3,
    paid: 10
  }
}
```

---

## ✅ 检查清单

使用归档功能时,确保:

**保存归档前:**
- [ ] 所有回复已收集
- [ ] 付款状态已更新
- [ ] 选择了有意义的名称

**开始新投票前:**
- [ ] 当前投票已保存 (如需保留)
- [ ] 已导出XLSX报告
- [ ] 确认可以清除当前回复

**恢复归档前:**
- [ ] 当前投票已保存 (如需保留)
- [ ] 确认要恢复的归档
- [ ] 知道恢复会覆盖当前数据

**删除归档前:**
- [ ] 确认不再需要此归档
- [ ] 已导出XLSX备份
- [ ] 理解删除无法撤销

---

**归档管理功能让你轻松管理多个投票活动!** 🎉

如有任何问题,请参考 README.md 或联系开发者。

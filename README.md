# Iizuka Lab Dinner Poll System

完整的研究组聚餐投票和管理系统,支持投票收集、价格计算、付款追踪和投票归档管理。

## 🌟 主要功能

### 📝 投票收集
- 参与者姓名
- 出席意愿 (是/否)
- 职称选择 (硕士生/博士生/教师职工)
- 多个可用日期选择
- 响应式表单设计

### 📊 管理仪表板
- 实时统计显示
- 交互式图表展示最受欢迎的日期
- 完整的回复表格
- 高级筛选和搜索

### 💰 智能定价系统
- 基于百分比的价格分配
- 三类人员独立定价
- 自动计算每人应付金额
- 实时价格预览

### ✅ 付款追踪
- 每个回复旁边有付款复选框
- 视觉状态指示器
- 付款统计显示
- 按付款状态筛选

### 🗂️ **投票归档管理** (新功能!)

#### 保存当前投票
- 为当前投票命名并保存到归档
- 保存所有回复、设置和统计信息
- 当前投票数据不会被清除

#### 开始新投票
- 清除所有当前回复
- 保留管理员设置(密码、价格、标题)
- 确认对话框防止误操作

#### 查看归档投票
- 显示所有已保存的投票列表
- 每个归档显示:
  - 投票名称和日期
  - 回复总数
  - 参加人数
  - 已付款人数

#### 恢复归档投票
- 将归档的投票恢复为当前投票
- 恢复所有回复和设置
- 确认对话框防止误操作

#### 导出归档投票
- 直接导出归档的投票数据
- XLSX格式,包含所有信息
- 无需先恢复归档

#### 删除归档投票
- 永久删除不需要的归档
- 确认对话框防止误删除

### 🏷️ 标题自定义
- 智能默认标题 (自动包含月份和年份)
- 自由修改投票标题
- 一键恢复默认

### 📤 数据导出
- CSV格式
- XLSX格式 (多工作表)
- PDF格式 (专业报告)
- 所有格式包含价格和付款状态

### 🔐 安全功能
- 密码保护管理页面
- 24小时会话管理
- 可修改管理员密码

## 📁 文件结构

```
project/
├── index.html              # 投票表单页面
├── admin-login.html        # 管理员登录页面
├── admin.html              # 管理员仪表板
├── css/
│   ├── style.css          # 投票表单样式
│   └── admin.css          # 管理页面样式
└── js/
    ├── poll.js            # 投票表单逻辑
    ├── login.js           # 登录验证逻辑
    └── admin.js           # 管理功能 (包含归档管理)
```

## 🚀 快速开始

### 1. 访问投票页面
打开 `index.html` 即可访问投票表单。

### 2. 管理员登录
- 点击页面底部的 "Admin" 链接
- 或直接访问 `admin-login.html`
- 默认密码: `iizukalab`
- **首次登录后请立即修改密码!**

### 3. 配置设置

#### 设置投票标题
1. 登录管理页面
2. 点击 "Title Settings"
3. 输入自定义标题或使用默认
4. 点击保存

#### 设置价格
1. 点击 "Price Settings"
2. 输入总费用
3. 设置三类人员的百分比 (必须总和为100%)
4. 查看实时预览
5. 点击保存

### 4. 管理投票归档

#### 保存当前投票到归档
1. 点击 "Poll Management"
2. 点击 "Save Current Poll to Archive"
3. 输入投票名称 (例如: "November 2024 Dinner")
4. 点击保存

#### 开始新投票
1. 点击 "Poll Management"
2. 点击 "Start New Poll"
3. 确认操作 (建议先保存当前投票)
4. 所有回复将被清除,设置保持不变

#### 查看和管理归档
1. 点击 "Poll Management"
2. 点击 "View Archived Polls"
3. 在列表中可以:
   - **Restore**: 恢复归档为当前投票
   - **Export**: 导出归档数据为XLSX
   - **Delete**: 删除归档

### 5. 收集回复
- 分享投票页面链接给参与者
- 在管理页面实时查看回复
- 使用图表选择最合适的日期

### 6. 追踪付款
- 查看每人的应付金额
- 收到款后勾选付款复选框
- 使用筛选查看未付款成员

### 7. 导出数据
- 选择导出格式 (CSV/XLSX/PDF)
- 下载包含所有信息的报告

## 💡 使用场景示例

### 场景1: 组织年度聚餐

**第1步: 创建新投票**
```
1. 登录管理页面
2. 设置标题: "Iizuka Lab Year-End Celebration 2024"
3. 设置价格: 总费用 ¥30,000
   - 硕士生: 15%
   - 博士生: 35%
   - 教师: 50%
```

**第2步: 收集回复**
```
1. 分享链接给所有成员
2. 在管理页面查看实时回复
3. 使用图表选择最合适的日期
```

**第3步: 确定日期后追踪付款**
```
1. 查看每人应付金额
2. 收款后勾选付款状态
3. 使用筛选查看未付款成员
```

**第4步: 活动结束后归档**
```
1. 点击 "Poll Management"
2. 点击 "Save Current Poll to Archive"
3. 输入名称: "2024 Year-End Dinner"
4. 导出最终报告
```

### 场景2: 管理多个投票活动

**保存当前投票**
```
1. Poll Management → Save Current Poll
2. 命名: "November Monthly Dinner"
```

**开始新投票**
```
1. Poll Management → Start New Poll
2. 确认清除当前回复
3. 开始收集新的投票
```

**查看历史投票**
```
1. Poll Management → View Archived Polls
2. 查看所有已归档的投票
3. 可以恢复、导出或删除
```

### 场景3: 恢复历史投票数据

**从归档恢复**
```
1. Poll Management → View Archived Polls
2. 找到需要的归档
3. 点击 "Restore"
4. 所有数据恢复为当前投票
```

**直接导出归档**
```
1. Poll Management → View Archived Polls
2. 找到需要的归档
3. 点击 "Export"
4. 无需恢复即可导出数据
```

## 🎯 价格计算示例

**输入:**
- 总费用: ¥10,000
- 硕士生: 20%
- 博士生: 30%
- 教师: 50%

**参与人数:**
- 4名硕士生
- 3名博士生
- 2名教师

**自动计算结果:**
- 硕士生: ¥10,000 × 20% ÷ 4 = ¥500/人
- 博士生: ¥10,000 × 30% ÷ 3 = ¥1,000/人
- 教师: ¥10,000 × 50% ÷ 2 = ¥2,500/人

## 📊 数据存储

所有数据存储在浏览器的 localStorage 中:

### 数据结构

**poll_responses** - 投票回复
```json
[
  {
    "id": "1234567890",
    "name": "张三",
    "willAttend": "yes",
    "title": "Doctoral Student",
    "availableDates": ["2024-11-20", "2024-11-21"],
    "paymentStatus": true,
    "timestamp": "2024-11-17T10:30:00Z"
  }
]
```

**admin_settings** - 管理设置
```json
{
  "password": "iizukalab",
  "totalCost": 10000,
  "masterPercent": 20,
  "doctoralPercent": 30,
  "staffPercent": 50,
  "pollTitle": "Iizuka Lab November 2024 Group Dinner Poll",
  "currentPollName": "Default Poll"
}
```

**poll_archives** - 投票归档 (新增!)
```json
[
  {
    "id": "1234567890",
    "name": "November 2024 Dinner",
    "date": "2024-11-17T10:00:00Z",
    "responses": [...],
    "settings": {...},
    "statistics": {
      "total": 15,
      "attending": 12,
      "notAttending": 3,
      "paid": 10
    }
  }
]
```

**admin_session** - 会话管理
```json
{
  "authenticated": true,
  "timestamp": 1700220000000,
  "expiresIn": 86400000
}
```

## ⚠️ 重要提示

### 数据备份
- **定期导出数据**: 使用XLSX或PDF导出功能保存备份
- **归档重要投票**: 使用归档功能保存历史投票数据
- **清除浏览器数据会丢失所有信息**

### 多设备使用
- 数据保存在本地浏览器
- 固定用一台电脑进行管理
- 不同设备的数据不同步

### 安全建议
- **立即修改默认密码**
- 不要在公共电脑上保持登录
- 定期更换管理员密码

### 归档管理建议
- **重要投票及时归档**: 完成后立即保存
- **命名规范**: 使用清晰的名称 (如: "2024-11 Monthly Dinner")
- **定期清理**: 删除不再需要的旧归档
- **导出备份**: 重要归档导出XLSX保存

## 🛠️ 故障排除

### 问题1: 登录后显示空白或错误
**解决方案**: 清除浏览器缓存,刷新页面

### 问题2: 图表不显示
**解决方案**: 确保有至少一个回复且选择了可用日期

### 问题3: 百分比无法保存
**解决方案**: 确认三个百分比的总和正好是100%

### 问题4: 归档恢复后数据不对
**解决方案**: 检查是否恢复了正确的归档,确认归档ID

### 问题5: 数据丢失
**解决方案**: 
- 检查是否清除了浏览器数据
- 查看归档列表,可能数据在归档中
- 从导出的XLSX/PDF文件恢复

## 📱 浏览器兼容性

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## 🎨 设计特色

- 现代化的渐变色设计
- 响应式布局 (支持手机/平板/电脑)
- 流畅的动画效果
- 直观的用户界面
- Font Awesome图标
- Chart.js数据可视化

## 📝 版本历史

### v2.0 (当前版本)
- ✨ 新增投票归档管理功能
- ✨ 支持保存当前投票到归档
- ✨ 支持开始新投票
- ✨ 支持查看、恢复、导出和删除归档
- ✨ 显示当前投票名称
- 🐛 修复图表无限增长bug
- 🐛 修复页面布局问题
- 🎨 改进归档列表UI

### v1.0
- ✨ 投票收集功能
- ✨ 百分比定价系统
- ✨ 付款追踪功能
- ✨ 标题自定义功能
- ✨ 数据导出功能
- ✨ 管理员认证

## 👨‍💻 开发者信息

专为东京大学 Iizuka Lab 研究组定制开发。

## 📄 许可证

MIT License

---

**默认管理员密码**: `iizukalab`

**建议**: 首次登录后立即修改密码!

祝使用愉快! 🎉
